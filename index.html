<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Wrike Projects (ASU)</title>
  <style>
    :root{
      --asu-maroon:#8C1D40;
      --asu-gold:#FFC627;
      --bg:#0b0f14;
      --card:#111827;
      --card2:#0f172a;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --border:#1f2937;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
    }

    html,body{height:100%;}
    body{
      margin:0;
      background: transparent;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 14px 14px 18px;
    }

    .header{
      background: linear-gradient(135deg, rgba(140,29,64,.35), rgba(255,198,39,.10));
      border:1px solid rgba(255,198,39,.18);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px 14px 12px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .dot{
      width:10px;height:10px;border-radius:999px;
      background: var(--asu-gold);
      box-shadow: 0 0 0 4px rgba(255,198,39,.16);
      flex:0 0 auto;
    }
    .title{
      font-weight: 800;
      letter-spacing:.2px;
      margin:0;
      font-size: 16px;
      line-height: 1.2;
    }
    .subtitle{
      margin:4px 0 0;
      color: var(--muted);
      font-size: 12px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin-top: 12px;
    }

    .card{
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(17,24,39,.9), rgba(15,23,42,.9));
      border-radius: var(--radius);
      box-shadow: 0 8px 22px rgba(0,0,0,.25);
      padding: 12px 12px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
    }

    .left{
      min-width:0;
    }

    .proj-title{
      margin:0;
      font-size: 14px;
      font-weight: 750;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .meta{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top: 6px;
      align-items:center;
      color: var(--muted);
      font-size: 12px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      color: var(--text);
      font-size: 12px;
    }

    .pill .bar{
      width:8px;height:8px;border-radius:999px;
      background: var(--asu-gold);
      opacity:.85;
    }

    .btn{
      appearance:none;
      border: 1px solid rgba(255,198,39,.55);
      background: rgba(140,29,64,.25);
      color: var(--text);
      border-radius: 999px;
      padding: 8px 12px;
      font-weight: 750;
      cursor:pointer;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
      flex:0 0 auto;
      white-space:nowrap;
    }
    .btn:hover{
      transform: translateY(-1px);
      background: rgba(140,29,64,.35);
      border-color: rgba(255,198,39,.85);
    }

    .status{
      opacity:.95;
    }

    .loading, .error, .empty{
      margin-top: 12px;
      border:1px dashed rgba(255,255,255,.18);
      border-radius: var(--radius);
      padding: 12px;
      color: var(--muted);
      background: rgba(0,0,0,.12);
    }

    .small{
      font-size: 12px;
      color: var(--muted);
      margin-top: 6px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="brand">
        <div class="dot"></div>
        <div>
          <p class="title">ASU Outreach Hub — Wrike Projects</p>
          <p class="subtitle" id="subtitle">Loading…</p>
        </div>
      </div>
    </div>

    <div id="content" class="grid"></div>
    <div id="msg" class="loading">Fetching projects you’re involved in…</div>
  </div>

<script>
  // ✅ CHANGE THIS to your Worker:
  // Example: https://wrike-proxy.dustinjsmith.workers.dev/projects
  const API_URL = "YOUR_WORKER_URL_HERE/projects?pmField=Project%20Manager";

  const content = document.getElementById("content");
  const msg = document.getElementById("msg");
  const subtitle = document.getElementById("subtitle");

  function setMessage(type, text) {
    msg.className = type;
    msg.textContent = text;
    msg.style.display = "block";
  }

  function hideMessage() {
    msg.style.display = "none";
  }

  function pill(label) {
    const el = document.createElement("span");
    el.className = "pill";
    const bar = document.createElement("span");
    bar.className = "bar";
    const t = document.createElement("span");
    t.textContent = label;
    el.appendChild(bar);
    el.appendChild(t);
    return el;
  }

  function render(projects) {
    content.innerHTML = "";
    for (const p of projects) {
      const card = document.createElement("div");
      card.className = "card";

      const left = document.createElement("div");
      left.className = "left";

      const h = document.createElement("p");
      h.className = "proj-title";
      h.textContent = p.title || "(Untitled)";
      left.appendChild(h);

      const meta = document.createElement("div");
      meta.className = "meta";

      if (p.status) {
        const s = document.createElement("span");
        s.className = "status";
        s.textContent = `Status: ${p.status}`;
        meta.appendChild(s);
      }

      if (Array.isArray(p.roles) && p.roles.length) {
        meta.appendChild(pill(p.roles.join(" + ")));
      }

      left.appendChild(meta);

      const a = document.createElement("a");
      a.className = "btn";
      a.href = p.openUrl;
      a.target = "_blank";
      a.rel = "noopener noreferrer";
      a.textContent = "Open";

      card.appendChild(left);
      card.appendChild(a);
      content.appendChild(card);
    }
  }

  async function load() {
    try {
      setMessage("loading", "Fetching projects you’re involved in…");
      const res = await fetch(API_URL, { cache: "no-store" });
      const data = await res.json();

      if (!data.ok) throw new Error(data.error || "Unknown error");

      subtitle.textContent = `User: ${data.user?.name || "Dustin"} • Projects: ${data.projects?.length || 0}`;

      const projects = data.projects || [];
      if (!projects.length) {
        content.innerHTML = "";
        setMessage("empty", "No matching projects found (PM or Assignee).");
        return;
      }

      hideMessage();
      render(projects);
    } catch (e) {
      content.innerHTML = "";
      subtitle.textContent = "Error";
      setMessage("error", `Error loading projects: ${e.message || e}`);
    }
  }

  load();
</script>
</body>
</html>
